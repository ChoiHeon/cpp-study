# 객체의 초기화

* c++의 객체(변수) 초기화 규칙은 명확히 존재하긴 하나, 확실한 초기화를 보장하지는 않습니다.
* 따라서 모든 객체는 사용하기 전에 항상 초기화가 수행되어야 합니다.

<br>

### 대입과 초기화

* 일반적으로 클래스의 생성자에서 사용되는 방법입니다.
* 다음은 대입을 사용한 생성자 구현입니다.

```c++
class Person {
private:
    int age;
    string name;
public: 
    Person(int _age, string _name) {
    	age = _age;		// 대입
        name = _name;	// 대입
	}
}
```

* c++의 규칙에 의하면 멤버 변수는 생성자가 실행되기 전에 초기화되어야 하기 때문에 이는 올바른 구현이 아닙니다.
* 다음은 대입 대신 초기화 리스트를 사용하는 방법입니다.

```c++
class Person {
private:
    int age;
    string name;
public:
    Person(int _age, string _name) : age(_age), name(_name) // 초기화
    { }
}
```

* 초기화 리스트는 대입보다 더 성능이 높습니다.

  * 대입으로 생성자를 구현했을 경우,  각 멤버 변수(기본 타입이 아닌)에 대한 기본 생성자가 호출되어 미리 초기화가 됩니다.
  * 이후, 초기화된 각 멤버 변수에 대해서 값을 대입하므로 총 두 번의 과정을 거치게 됩니다.
  * 하지만 초기화 리스트를 사용하면 생성자의 매개변수가 각 멤버 변수의 생성자의 인자로 사용되기 때문에 총 1번의 과정을 거치게 됩니다.

* 초기화 리스트를 사용할 때는 아래의 규칙에 따르는 좋습니다.

  1. 기본 타입 여부와 상관없이 모든 멤버 변수는 초기화 리스트에 넣어야 합니다.
     * 상수 또는 참조형 변수는 대입이 불가능하기 때문에 초기화 리스트를 사용하지 않을 경우 에러가 발생할 수 있습니다.
     * 특정 멤버 변수가 초기화되지 않는 상황을 미리 방지할 수 있습니다.

  2. 만약 생성자에서 멤버 변수를 특정 값으로 초기화할 생각이 없더라도 초기화 리스트를 사용하는 습관을 들이는 것이 좋습니다.

     ```c++
     Person() : age(), name() 
     {}
     ```

  3. 멤버 변수의 선언 순서와 초기화 리스트 내의 순서가 일치해야 합니다.

     * 초기화는 초기화 리스트 내의 순서가 아닌, 멤버 변수 선언 순서에 따라 수행됩니다.
     * 따라서 순서를 동일하게 하면 얘기치 못한 버그 발생 시, 좀 더 문제점을 찾기가 수월해집니다.

<br>

### 객체를 구성하는 데이터와 초기화 순서

* 순서는 컴파일러의 종류와 상관없이 항상 동일합니다.

  * Base 클래스는 Derived 클래스보다 먼저 초기화

  * 클래스 데이터 멤버는 선언된 순서대로 초기화

<br>

### 비지역 정적 객체의 초기화 순서

* 비지역 정적 객체 (non-local static object)는 개별 번역 단위에서 정해집니다.

* 정적 객체는 생성된 시점부터 프로그램이 끝날 때까지 살아있는 객체를 의미합니다.

  > 정적 객체는 다음을 포함하는 개념입니다.
  >
  > 1. 전역 객체
  > 2. 네임스페이스 유효 범위에서 정의된 객체
  > 3. 클래스 안에서 static을 선언된 객체
  > 4. 함수 안에서 static으로 선언된 객체 
  > 5. 파일 유효 범위에서 static으로 정의된 객체
  >
  > 4번을 제외한 나머지 객체를 **비지역 정적 객체**라고 합니다.

* 번역 단위 (translation unit)는 컴파일을 통해 하나의 목적 파일 (object file)을 만드는 바탕이 되는 소스 코드를 의미합니다.

  > 여기서 번역은 소스의 언어를 기계어로 옮긴다는 의미입니다.
  >
  > 기본적으로는 소스 파일 하나를 의미하며 #include 에 선언된 파일까지 합쳐서
  >
  > 하나의 번역 단위가 됩니다.

* 따라서 임의의 번역 단위에서 정의된 비지역 정적 객체가 다른 번역 단위의 비지역 정적 객체를 사용할 때, 초기화의 순서가 정해져 있지 않으므로 문제가 발생할 수 있습니다.
* 이를 해결하기 위해선 비지역 정적으로 선언한 객체를 대신 함수내에서 선언한 뒤, 참조형으로 반환하여 **지역 정적 객체**로 다뤄야 합니다.

<br>

### 결론

1. 기본 타입의 변수는 개발자가 직접 초기화를 해야 합니다.
2. 클래스의 생성자는 초기화 리스트를 활용해여 구현해야 합니다. 이 때 선언한 순서와 리스트의 순서가 동일한 것이 좋습니다.
3. 비지역 정적 객체는 번역 단위를 고려했을 때 문제가 발생하는지 여부를 판단하여 사용해야 합니다. 사용해야 한다면 함수를 이용해 지역 정적 객체로 다루어야 합니다.